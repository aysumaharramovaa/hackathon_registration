<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<title>Hackathon Admin Panel</title>
<style>
  body { font-family: Arial; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #f4f4f4; }
  button.delete { background:#ff4d4f;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;}
</style>
</head>
<body>

<h1>Hackathon Admin Panel</h1>

<table id="applicationsTable">
  <thead>
    <tr>
      <th>Team ID</th>
      <th>Team Name</th>
      <th>Members</th>
      <th>Emails</th>
      <th>Phones</th>
      <th>Groups</th>
      <th>Idea</th>
      <th>Created At</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const tableBody = document.querySelector('#applicationsTable tbody');

async function fetchApplications(){
  try {
    const res = await fetch('/api/applications');
    const data = await res.json();
    tableBody.innerHTML = '';

    data.forEach(team => {
      const row = document.createElement('tr');

      // Bütün üzvləri bir sətrdə birləşdiririk
      const memberNames = team.members.map(m => m.name).join(', ');
      const memberEmails = team.members.map(m => m.email).join(', ');
      const memberPhones = team.members.map(m => m.phone).join(', ');
      const memberGroups = team.members.map(m => m.group_name).join(', ');

      row.innerHTML = `
        <td>${team.id}</td>
        <td>${team.team_name}</td>
        <td>${memberNames}</td>
        <td>${memberEmails}</td>
        <td>${memberPhones}</td>
        <td>${memberGroups}</td>
        <td>${team.idea}</td>
        <td>${new Date(team.created_at).toLocaleString()}</td>
        <td><button class="delete">Sil</button></td>
      `;

      row.querySelector('.delete').addEventListener('click', () => deleteTeam(team.id));
      tableBody.appendChild(row);
    });

  } catch(err){
    console.error(err);
    tableBody.innerHTML = '<tr><td colspan="9">Server error</td></tr>';
  }
}

async function deleteTeam(teamId){
  if(!confirm("Bu komandani silmək istədiyinizə əminsiniz?")) return;

  try {
    const res = await fetch('/api/applications', {
      method:'DELETE',
      headers: {
        "Content-Type":"application/json"
      },
      body: JSON.stringify({teamId})
    });

    const data = await res.json();
    alert(data.message || data.error);
    fetchApplications();
  } catch(err){
    alert("Server error!");
    console.error(err);
  }
}

fetchApplications();
setInterval(fetchApplications, 30000);
</script>

</body>
</html>