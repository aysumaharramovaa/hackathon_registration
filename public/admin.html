<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<title>Hackathon Admin Panel</title>
<style>
  body { font-family: Arial; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #f4f4f4; }
  button.delete { background:#ff4d4f;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;}
</style>
</head>
<body>

<h1>Hackathon Admin Panel</h1>

<table id="applicationsTable">
  <thead>
    <tr>
      <th>Team ID</th>
      <th>Team Name</th>
      <th>Member Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Group</th>
      <th>Idea</th>
      <th>Created At</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const tableBody = document.querySelector('#applicationsTable tbody');
let ADMIN_PASS = "";

function askPassword(){
  ADMIN_PASS = prompt("Admin parolunu daxil edin:");
  if (!ADMIN_PASS) askPassword();
  else fetchApplications();
}

async function fetchApplications(){
  try {
    const res = await fetch('/api/applications', {
      headers: { "x-admin-password": ADMIN_PASS }
    });

    if(res.status===401){
      alert("Yanlış parol!");
      askPassword();
      return;
    }

    const data = await res.json();
    tableBody.innerHTML = '';

    data.forEach(team => {
      team.members.forEach(member => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${team.id}</td>
          <td>${team.team_name}</td>
          <td>${member.name}</td>
          <td>${member.email}</td>
          <td>${member.phone}</td>
          <td>${member.group_name}</td>
          <td>${team.idea}</td>
          <td>${new Date(team.created_at).toLocaleString()}</td>
          <td><button class="delete">Sil</button></td>
        `;
        row.querySelector('.delete').addEventListener('click', ()=> deleteTeam(team.id));
        tableBody.appendChild(row);
      });
    });

  } catch(err){
    console.error(err);
    tableBody.innerHTML = '<tr><td colspan="9">Server error</td></tr>';
  }
}

async function deleteTeam(teamId){
  if(!confirm("Bu komandani silmək istədiyinizə əminsiniz?")) return;

  try {
    const res = await fetch('/api/applications', {
      method:'DELETE',
      headers: {
        "Content-Type":"application/json",
        "x-admin-password": ADMIN_PASS
      },
      body: JSON.stringify({teamId})
    });

    const data = await res.json();
    alert(data.message || data.error);
    fetchApplications();
  } catch(err){
    alert("Server error!");
    console.error(err);
  }
}

askPassword();
setInterval(fetchApplications, 30000);
</script>

</body>
</html>
